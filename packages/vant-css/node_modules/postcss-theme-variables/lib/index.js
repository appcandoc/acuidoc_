'use strict';

var postcss = require('postcss');
var startsWith = require('lodash/startsWith');
var has = require('lodash/has');

module.exports = postcss.plugin('postcss-theme-variables', function (options) {
  options = options || {};
  var vars = options.vars || {};
  var prefix = options.prefix || '';

  return function (css) {
    css.walkDecls(function (decl) {
      var prop = decl.prop;


      if (!startsWith(prop, prefix)) {
        return;
      }

      var symbol = prop.slice(prefix.length);

      if (has(vars, symbol)) {
        decl.value = vars[symbol];
      } else if (prefix && has(vars, prop)) {
        decl.value = vars[prop];
      }
    });
  };
});